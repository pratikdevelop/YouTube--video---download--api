<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube - Social Media Video Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-100">

    <!-- Navbar -->
    <nav class="bg-blue-600 p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-white text-2xl font-bold hover:text-yellow-300 transition duration-300">Social Media
                Video Downloader</a>
            <ul class="hidden lg:flex space-x-8 items-center">
                <li><a href="youtube" class="text-white hover:text-yellow-300">YouTube</a></li>
                <li><a href="instagram" class="text-white hover:text-yellow-300">Instagram</a></li>
                <li><a href="facebook" class="text-white hover:text-yellow-300">Facebook</a></li>
                <li><a href="image-to-video" class="text-white hover:text-yellow-300">Image to Video</a></li>
                <li><a href="video-generated" class="text-white hover:text-yellow-300">Video Generated by Script</a>
                </li>
            </ul>
            <div class="hidden lg:flex space-x-4">
                <a href="login" class="text-white bg-green-500 px-4 py-2 rounded-md hover:bg-green-700">Login</a>
                <a href="signup" class="text-white bg-yellow-500 px-4 py-2 rounded-md hover:bg-yellow-700">Sign Up</a>
            </div>
        </div>
    </nav>

    <!-- Content -->
    <div class="container mx-auto p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Download YouTube Videos</h1>
        <p class="text-lg text-gray-600 mb-4">Enter the YouTube URL to download the video. You can also choose the
            segment length for downloading part of the video.</p>

        <!-- Video Download Form -->
        <form id="videoForm" class="mb-6">
            <input type="url" id="videoUrl" placeholder="Enter YouTube URL"
                class="w-full p-3 border border-gray-300 rounded-md mb-4" required>

            <label for="segmentLength" class="text-gray-700 font-medium">Segment Length (in seconds):</label>
            <input type="number" id="segmentLength" placeholder="e.g., 30"
                class="w-full p-3 border border-gray-300 rounded-md mb-6" min="1" required>

            <button type="submit"
                class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition duration-300">Download
                Video</button>
        </form>

        <!-- Response Message -->
        <div id="responseMessage" class="text-lg text-gray-600 mb-4"></div>

        <!-- Processed Videos List -->
        <h2 class="text-xl font-semibold text-gray-800">Processed Videos</h2>
        <ul id="videoList" class="mt-6 space-y-4">
            <!-- Dynamic Video List Will Appear Here -->
        </ul>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const videoForm = document.getElementById("videoForm");
            const responseMessage = document.getElementById("responseMessage");

            // Handle form submission
            videoForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                const url = document.getElementById("videoUrl").value;
                const segmentLength = document.getElementById("segmentLength").value;

                // Display loading message
                responseMessage.textContent = "Processing video... Please wait.";

                try {
                    const response = await fetch("/process-video", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ url, segment_length: segmentLength })
                    });

                    if (response.ok) {
                        responseMessage.textContent = "Video processed successfully! Check below for the download link.";
                        fetchProcessedVideos(); // Refresh the list after processing
                    } else {
                        responseMessage.textContent = `Error processing video: ${response.statusText}`;
                    }
                } catch (error) {
                    responseMessage.textContent = `Error: ${error.message}`;
                }
            });
        });

        // Fetch and display processed videos from server
        async function fetchProcessedVideos() {
            try {
                const response = await fetch("/list-videos?type=youtube");
                const data = await response.json();
                console.log(
                    "Processed Videos List: ",
                    data
                );
                
                const videoList = document.getElementById("videoList");
                videoList.innerHTML = ""; // Clear existing list

                data.forEach((video) => {
                    const videoItem = document.createElement("li");
                    videoItem.classList.add("bg-white", "p-6", "rounded-lg", "shadow-lg");

                    const videoLink = document.createElement("a");
                    videoLink.href = video.url;
                    videoLink.textContent = video.name;
                    videoLink.classList.add("text-blue-600", "hover:underline");

                    videoItem.appendChild(videoLink);
                    videoList.appendChild(videoItem);
                });
            } catch (error) {
                console.error("Error fetching processed videos:", error);
            }
        }

        fetchProcessedVideos(); // Initial fetch
    </script>

</body>

</html>